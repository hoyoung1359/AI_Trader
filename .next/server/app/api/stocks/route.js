"use strict";(()=>{var e={};e.id=276,e.ids=[276],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},8162:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>E,originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>l,routeModule:()=>h,serverHooks:()=>d,staticGenerationAsyncStorage:()=>k,staticGenerationBailout:()=>y});var o={};r.r(o),r.d(o,{GET:()=>u});var s=r(5419),i=r(9108),a=r(9678),c=r(8070),n=r(2016),p=r(3169);async function u(e){let{searchParams:t}=new URL(e.url),r=t.get("query")||"";try{let{data:e,error:t}=await n.O.from("stock_master").select("*").ilike("name",`%${r}%`).limit(20);if(t)throw t;let o=new p.Y,s=await Promise.all(e.map(async e=>{try{let t=await o.getStockPrice(e.symbol);return{...e,price:t.price,change:t.change,volume:t.volume,high:t.high,low:t.low}}catch(t){return console.error(`Error fetching price for ${e.symbol}:`,t),e}}));return c.Z.json(s)}catch(e){return console.error("Error searching stocks:",e),c.Z.json({error:"Failed to search stocks"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/stocks/route",pathname:"/api/stocks",filename:"route",bundlePath:"app/api/stocks/route"},resolvedPagePath:"C:\\Coding\\Virtual Trader\\src\\app\\api\\stocks\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:k,serverHooks:d,headerHooks:E,staticGenerationBailout:y}=h,g="/api/stocks/route";function w(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:k})}},3169:(e,t,r)=>{r.d(t,{Y:()=>o});class o{constructor(){this.baseUrl="https://openapi.koreainvestment.com:9443",this.apiKey=process.env.KOREA_INVESTMENT_API_KEY,this.apiSecret=process.env.KOREA_INVESTMENT_API_SECRET,this.accessToken=null,this.tokenExpiresAt=null}async getAccessToken(){try{if(this.accessToken&&this.tokenExpiresAt&&this.tokenExpiresAt>new Date)return this.accessToken;let e=await fetch(`${this.baseUrl}/oauth2/tokenP`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"client_credentials",appkey:this.apiKey,appsecret:this.apiSecret})});if(!e.ok)throw Error("Failed to get access token");let t=await e.json();if(!t.access_token)throw Error("No access token received");return this.accessToken=t.access_token,this.tokenExpiresAt=new Date(Date.now()+828e5),this.accessToken}catch(e){throw console.error("Error getting access token:",e),e}}async getStockPrice(e){try{let t=await this.getAccessToken(),r=await fetch(`${this.baseUrl}/uapi/domestic-stock/v1/quotations/inquire-price?FID_COND_MRKT_DIV_CODE=J&FID_INPUT_ISCD=${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`,appkey:this.apiKey,appsecret:this.apiSecret,tr_id:"FHKST01010100","content-type":"application/json"}});if(!r.ok)throw Error("Failed to fetch stock price");let o=await r.json();if(!o.output)throw Error("No price data received");return{price:parseFloat(o.output.stck_prpr)||0,change:parseFloat(o.output.prdy_ctrt)||0,volume:parseInt(o.output.acml_vol)||0,high:parseFloat(o.output.high)||0,low:parseFloat(o.output.low)||0}}catch(e){throw console.error("Error fetching stock price:",e),e}}async getStockHistory(e,t,r){try{let e=await this.getAccessToken(),t=await fetch(`${this.baseUrl}/uapi/domestic-stock/v1/quotations/inquire-daily-price`,{method:"GET",headers:{Authorization:`Bearer ${e}`,appkey:this.apiKey,appsecret:this.apiSecret,tr_id:"FHKST01010400","content-type":"application/json"}});if(!t.ok)throw Error("Failed to fetch stock history");return(await t.json()).output||[]}catch(e){throw console.error("Error fetching stock history:",e),e}}}},2016:(e,t,r)=>{r.d(t,{O:()=>s});var o=r(7890);if(!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("Missing env.SUPABASE_SERVICE_ROLE_KEY");let s=(0,o.eI)("https://uypvrugprpujbbaudtoi.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,206,890],()=>r(8162));module.exports=o})();