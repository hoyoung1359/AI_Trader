"use strict";(()=>{var e={};e.id=276,e.ids=[276],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},8162:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>d,originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>l,routeModule:()=>h,serverHooks:()=>E,staticGenerationAsyncStorage:()=>k,staticGenerationBailout:()=>m});var o={};r.r(o),r.d(o,{GET:()=>u});var s=r(5419),a=r(9108),i=r(9678),c=r(8070),n=r(2016),p=r(3169);async function u(e){let{searchParams:t}=new URL(e.url),r=t.get("query")||"";try{let{data:e,error:t}=await n.O.from("stock_master").select("*").ilike("name",`%${r}%`).limit(20);if(t)throw t;let o=new p.Y,s=await Promise.all(e.map(async e=>{try{let t=await o.getStockPrice(e.symbol);return{symbol:e.symbol,name:e.name,market:e.market,sector:e.sector,price:t.price,change:t.change,volume:t.volume,high:t.high,low:t.low}}catch(t){return console.error(`Error fetching price for ${e.symbol}:`,t),{...e,price:0,change:0,volume:0,high:0,low:0}}}));return c.Z.json(s)}catch(e){return console.error("Error fetching stocks:",e),c.Z.json({error:"Failed to fetch stocks"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/stocks/route",pathname:"/api/stocks",filename:"route",bundlePath:"app/api/stocks/route"},resolvedPagePath:"C:\\Coding\\Virtual Trader\\src\\app\\api\\stocks\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:k,serverHooks:E,headerHooks:d,staticGenerationBailout:m}=h,g="/api/stocks/route";function _(){return(0,i.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:k})}},3169:(e,t,r)=>{r.d(t,{Y:()=>o});class o{constructor(){this.baseUrl="https://openapi.koreainvestment.com:9443",this.apiKey=process.env.KOREA_INVESTMENT_API_KEY,this.apiSecret=process.env.KOREA_INVESTMENT_API_SECRET,this.accessToken=null,this.tokenExpiresAt=null}async getAccessToken(){try{if(this.accessToken&&this.tokenExpiresAt&&this.tokenExpiresAt>new Date)return this.accessToken;let e=await fetch(`${this.baseUrl}/oauth2/tokenP`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"client_credentials",appkey:this.apiKey,appsecret:this.apiSecret})});if(!e.ok)throw Error("Failed to get access token");let t=await e.json();if(!t.access_token)throw Error("No access token received");return this.accessToken=t.access_token,this.tokenExpiresAt=new Date(Date.now()+828e5),this.accessToken}catch(e){throw console.error("Error getting access token:",e),e}}async getStockPrice(e){try{let t=await this.getAccessToken(),r=await fetch(`${this.baseUrl}/uapi/domestic-stock/v1/quotations/inquire-price?FID_COND_MRKT_DIV_CODE=J&FID_INPUT_ISCD=${e}`,{headers:{Authorization:`Bearer ${t}`,appkey:this.apiKey,appsecret:this.apiSecret,tr_id:"FHKST01010100"}});if(!r.ok)throw Error("Failed to fetch stock price");let o=await r.json();return{price:parseFloat(o.output.stck_prpr),change:parseFloat(o.output.prdy_ctrt),volume:parseInt(o.output.acml_vol),high:parseFloat(o.output.high),low:parseFloat(o.output.low)}}catch(e){throw console.error("Error fetching stock price:",e),e}}}},2016:(e,t,r)=>{r.d(t,{O:()=>s});var o=r(7890);if(!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("Missing env.SUPABASE_SERVICE_ROLE_KEY");let s=(0,o.eI)("https://uypvrugprpujbbaudtoi.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,159],()=>r(8162));module.exports=o})();