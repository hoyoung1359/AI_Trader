"use strict";(()=>{var e={};e.id=276,e.ids=[276],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8162:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>d,originalPathname:()=>w,patchFetch:()=>g,requestAsyncStorage:()=>u,routeModule:()=>h,serverHooks:()=>k,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>y});var o={};r.r(o),r.d(o,{GET:()=>p});var s=r(5419),a=r(9108),i=r(9678),c=r(8070),n=r(3169);async function p(e){let{searchParams:t}=new URL(e.url),r=t.get("query")||"";try{let e=new n.Y,t=await e.searchStocks(r),o=await Promise.all(t.map(async t=>{try{let r=await e.getStockPrice(t.symbol);return{...t,price:r.price,change:r.change,volume:r.volume,high:r.high,low:r.low}}catch(e){return console.error(`Error fetching price for ${t.symbol}:`,e),t}}));return c.Z.json(o)}catch(e){return console.error("Error searching stocks:",e),c.Z.json({error:"Failed to search stocks"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/stocks/route",pathname:"/api/stocks",filename:"route",bundlePath:"app/api/stocks/route"},resolvedPagePath:"C:\\Coding\\Virtual Trader\\src\\app\\api\\stocks\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:u,staticGenerationAsyncStorage:l,serverHooks:k,headerHooks:d,staticGenerationBailout:y}=h,w="/api/stocks/route";function g(){return(0,i.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:l})}},3169:(e,t,r)=>{r.d(t,{Y:()=>o});class o{constructor(){this.baseUrl="https://openapi.koreainvestment.com:9443",this.apiKey=process.env.KOREA_INVESTMENT_API_KEY,this.apiSecret=process.env.KOREA_INVESTMENT_API_SECRET,this.accessToken=null,this.tokenExpiresAt=null}async getAccessToken(){try{if(this.accessToken&&this.tokenExpiresAt&&this.tokenExpiresAt>new Date)return this.accessToken;let e=await fetch(`${this.baseUrl}/oauth2/tokenP`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"client_credentials",appkey:this.apiKey,appsecret:this.apiSecret})});if(!e.ok)throw Error("Failed to get access token");let t=await e.json();if(!t.access_token)throw Error("No access token received");return this.accessToken=t.access_token,this.tokenExpiresAt=new Date(Date.now()+828e5),this.accessToken}catch(e){throw console.error("Error getting access token:",e),e}}async getStockPrice(e){try{let t=await this.getAccessToken(),r=await fetch(`${this.baseUrl}/uapi/domestic-stock/v1/quotations/inquire-price?FID_COND_MRKT_DIV_CODE=J&FID_INPUT_ISCD=${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`,appkey:this.apiKey,appsecret:this.apiSecret,tr_id:"FHKST01010100","content-type":"application/json"}});if(!r.ok)throw Error("Failed to fetch stock price");let o=await r.json();if(!o.output)throw Error("No price data received");return{price:parseFloat(o.output.stck_prpr)||0,change:parseFloat(o.output.prdy_ctrt)||0,volume:parseInt(o.output.acml_vol)||0,high:parseFloat(o.output.high)||0,low:parseFloat(o.output.low)||0}}catch(e){throw console.error("Error fetching stock price:",e),e}}async getStockHistory(e,t,r){try{let e=await this.getAccessToken(),t=await fetch(`${this.baseUrl}/uapi/domestic-stock/v1/quotations/inquire-daily-price`,{method:"GET",headers:{Authorization:`Bearer ${e}`,appkey:this.apiKey,appsecret:this.apiSecret,tr_id:"FHKST01010400","content-type":"application/json"}});if(!t.ok)throw Error("Failed to fetch stock history");return(await t.json()).output||[]}catch(e){throw console.error("Error fetching stock history:",e),e}}async searchStocks(e){try{let t=await this.getAccessToken(),r=await fetch(`${this.baseUrl}/uapi/domestic-stock/v1/quotations/search-stock?query=${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${t}`,appkey:this.apiKey,appsecret:this.apiSecret,tr_id:"HHDFS00000300"}});if(!r.ok)throw Error("Failed to search stocks");return(await r.json()).output.map(e=>({symbol:e.mksc_shrn_iscd,name:e.hts_kor_isnm,market:"01"===e.bstp_cls_code?"KOSPI":"KOSDAQ",sector:e.bstp_kor_isnm}))}catch(e){throw console.error("Error searching stocks:",e),e}}async subscribeToStockPrice(e,t){try{let r=await this.getAccessToken(),o=new WebSocket(`${this.baseUrl}/websocket`);return o.onopen=()=>{o.send(JSON.stringify({header:{token:r,appkey:this.apiKey,appsecret:this.apiSecret,tr_type:"1",tr_id:"H0STCNT0"},body:{input:{symbol:e}}}))},o.onmessage=e=>{let r=JSON.parse(e.data);t(r)},o}catch(e){throw console.error("Error subscribing to stock price:",e),e}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,206],()=>r(8162));module.exports=o})();