(()=>{var e={};e.id=931,e.ids=[931],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},2739:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>o});var a=s(482),r=s(9108),l=s(2563),n=s.n(l),i=s(8300),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);s.d(t,c);let o=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,1136)),"C:\\Coding\\Virtual Trader\\src\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1342)),"C:\\Coding\\Virtual Trader\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Coding\\Virtual Trader\\src\\app\\page.tsx"],u="/page",x={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8785:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2583,23)),Promise.resolve().then(s.t.bind(s,6840,23)),Promise.resolve().then(s.t.bind(s,8771,23)),Promise.resolve().then(s.t.bind(s,3225,23)),Promise.resolve().then(s.t.bind(s,9295,23)),Promise.resolve().then(s.t.bind(s,3982,23))},3130:(e,t,s)=>{Promise.resolve().then(s.bind(s,1486))},3045:(e,t,s)=>{Promise.resolve().then(s.bind(s,6101))},1486:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var a=s(5344),r=s(759),l=s.n(r);s(3824);var n=s(5814),i=s(8428),c=s(6506),o=s(3729),d=s(5332);function u(){let[e,t]=(0,o.useState)([]),[s,r]=(0,o.useState)(0),[l,n]=(0,o.useState)(!1);(0,o.useEffect)(()=>{i();let e=d.O.channel("notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications"},e=>{let s=e.new;t(e=>[s,...e]),r(e=>e+1)}).subscribe();return()=>{e.unsubscribe()}},[]);let i=async()=>{let{data:e,error:s}=await d.O.from("notifications").select("*").order("created_at",{ascending:!1}).limit(20);e&&(t(e),r(e.filter(e=>!e.read).length))},c=async e=>{await d.O.from("notifications").update({read:!0}).eq("id",e),t(t=>t.map(t=>t.id===e?{...t,read:!0}:t)),r(e=>Math.max(0,e-1))};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>n(!l),className:"relative p-2 text-gray-600 hover:text-gray-900",children:[a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),s>0&&a.jsx("span",{className:"absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full",children:s})]}),l&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg z-50",children:[a.jsx("div",{className:"p-4 border-b",children:a.jsx("h3",{className:"text-lg font-semibold",children:"알림"})}),a.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===e.length?a.jsx("div",{className:"p-4 text-center text-gray-500",children:"알림이 없습니다"}):e.map(e=>(0,a.jsxs)("div",{className:`p-4 border-b hover:bg-gray-50 cursor-pointer ${e.read?"":"bg-blue-50"}`,onClick:()=>c(e.id),children:[a.jsx("p",{className:"text-sm text-gray-900",children:e.message}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.created_at).toLocaleString()})]},e.id))})]})]})}function x({children:e}){let{user:t,loading:s,signOut:r}=(0,n.a)(),l=(0,i.usePathname)(),o=(0,i.useRouter)();return(console.log("Auth State:",{user:t,loading:s,pathname:l}),s)?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"loading loading-lg"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"로딩 중..."})]})}):t||["/login","/register"].includes(l)?t&&["/login","/register"].includes(l)?(o.push("/"),null):["/login","/register"].includes(l)?e:(0,a.jsxs)("div",{className:"min-h-screen flex",children:[(0,a.jsxs)("div",{className:"w-64 bg-white shadow-lg",children:[a.jsx("div",{className:"p-4",children:a.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"주식 가상매매"})}),a.jsx("nav",{className:"mt-4",children:[{name:"홈",path:"/"},{name:"포트폴리오",path:"/portfolio"},{name:"거래내역",path:"/transactions"},{name:"관심종목",path:"/watchlist"}].map(e=>a.jsx(c.default,{href:e.path,className:`block px-4 py-2 text-sm ${l===e.path?"bg-blue-50 text-blue-600 border-r-4 border-blue-600":"text-gray-600 hover:bg-gray-50"}`,children:e.name},e.path))})]}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("header",{className:"bg-white shadow",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"주식 가상매매 시뮬레이터"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx(u,{}),a.jsx("button",{onClick:()=>r(),className:"text-sm text-gray-600 hover:text-gray-900",children:"로그아웃"})]})]})}),a.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e})]})]}):(console.log("Redirecting to login..."),o.push("/login"),a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:a.jsx("div",{className:"text-center",children:a.jsx("p",{className:"text-gray-600",children:"로그인 페이지로 이동 중..."})})}))}function h({children:e}){return a.jsx("html",{lang:"ko",children:a.jsx("body",{className:l().className,children:a.jsx(n.H,{children:a.jsx(x,{children:e})})})})}},6101:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(5344),r=s(3729),l=s(4994);let n=[{value:"",label:"전체 섹터"},{value:"IT",label:"IT"},{value:"금융",label:"금융"},{value:"화학",label:"화학"},{value:"자동차",label:"자동차"},{value:"철강",label:"철강/금속"},{value:"통신",label:"통신"},{value:"유통",label:"유통"},{value:"건설",label:"건설"},{value:"의약품",label:"의약품"},{value:"전기전자",label:"전기전자"},{value:"서비스",label:"서비스업"}],i=[{value:"marketCap",label:"시가총액"},{value:"volume",label:"거래량"},{value:"price",label:"현재가"},{value:"change",label:"등락률"}],c=({currentPage:e,totalPages:t,onPageChange:s})=>{let r=Array.from({length:t},(e,t)=>t+1).slice(Math.max(0,e-3),Math.min(t,e+2));return(0,a.jsxs)("div",{className:"flex justify-center gap-2 mt-4",children:[e>1&&a.jsx("button",{onClick:()=>s(e-1),className:"px-3 py-1 rounded bg-gray-200 hover:bg-gray-300",children:"이전"}),r.map(t=>a.jsx("button",{onClick:()=>s(t),className:`px-3 py-1 rounded ${e===t?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300"}`,children:t},t)),e<t&&a.jsx("button",{onClick:()=>s(e+1),className:"px-3 py-1 rounded bg-gray-200 hover:bg-gray-300",children:"다음"})]})};function o({onSelectStock:e}){let[t,s]=(0,r.useState)([]),[o,d]=(0,r.useState)(!0),[u,x]=(0,r.useState)(1),[h,m]=(0,r.useState)(1),[g,p]=(0,r.useState)(""),[b,v]=(0,r.useState)("marketCap"),[j,y]=(0,r.useState)(null);return((0,r.useEffect)(()=>{let e=async()=>{d(!0),y(null);try{let e=await fetch(`/api/stocks/kospi?page=${u}&sector=${g}&sortBy=${b}`);if(!e.ok)throw Error("주식 정보를 불러오는데 실패했습니다.");let t=await e.json();s(t.stocks),m(t.totalPages)}catch(e){console.error("Failed to fetch stocks:",e),y(e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다.")}finally{d(!1)}};e();let t=setInterval(e,6e5);return()=>clearInterval(t)},[u,g,b]),j)?(0,a.jsxs)("div",{className:"p-4 text-center text-red-500",children:[a.jsx("p",{children:j}),a.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"새로고침"})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-xl font-bold",children:"코스피 종목"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[a.jsx("select",{value:g,onChange:e=>p(e.target.value),className:"border rounded p-2",children:n.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsx("select",{value:b,onChange:e=>v(e.target.value),className:"border rounded p-2",children:i.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]})]}),o?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:50}).map((e,t)=>(0,a.jsxs)("div",{className:"p-4 border rounded-lg animate-pulse bg-gray-100",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]},t))}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(t=>a.jsx("div",{className:"p-4 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>e(t),children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"font-medium",children:t.name}),a.jsx("p",{className:"text-sm text-gray-500",children:t.symbol})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-lg font-bold",children:[t.price?.toLocaleString(),"원"]}),t.change&&(0,a.jsxs)("div",{className:`flex items-center justify-end ${t.change>=0?"text-red-600":"text-blue-600"}`,children:[t.change>=0?a.jsx(l.YfH,{className:"mr-1"}):a.jsx(l.KYc,{className:"mr-1"}),(0,a.jsxs)("span",{children:[Math.abs(t.change).toFixed(2),"%"]})]})]})]})},t.symbol))}),a.jsx(c,{currentPage:u,totalPages:h,onPageChange:x})]})}var d=s(5814);function u({stock:e}){let[t,s]=(0,r.useState)(0),[l,n]=(0,r.useState)(!1),{user:i}=(0,d.a)(),c=async a=>{if(e&&i){n(!0);try{if(!(await fetch("/api/trade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:i.id,symbol:e.symbol,quantity:t,type:a,price:e.price})})).ok)throw Error("거래 실패");alert(`${"buy"===a?"매수":"매도"} 완료!`),s(0)}catch(e){alert("거래 처리 중 오류가 발생했습니다."),console.error("Trade error:",e)}finally{n(!1)}}};return e?(0,a.jsxs)("div",{className:"p-4 border rounded-lg",children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:e.name}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[e.price?.toLocaleString(),"원"]}),(0,a.jsxs)("p",{className:`${e.change&&e.change>=0?"text-red-600":"text-blue-600"}`,children:[e.change,"%"]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"주문수량"}),a.jsx("input",{type:"number",min:"1",value:t,onChange:e=>s(Math.max(1,parseInt(e.target.value)||0)),className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("button",{onClick:()=>c("buy"),disabled:l,className:"p-2 bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:"매수"}),a.jsx("button",{onClick:()=>c("sell"),disabled:l,className:"p-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"매도"})]}),t>0&&e.price&&(0,a.jsxs)("div",{className:"mt-4 text-right",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"주문총액"}),(0,a.jsxs)("p",{className:"text-lg font-bold",children:[(t*e.price).toLocaleString(),"원"]})]})]}):a.jsx("div",{className:"p-4 text-center text-gray-500",children:"거래할 종목을 선택해주세요"})}function x(){let[e,t]=(0,r.useState)(null);return a.jsx("div",{className:"container mx-auto p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsx("div",{className:"md:col-span-2",children:a.jsx(o,{onSelectStock:t})}),(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-2xl font-bold mb-4",children:"거래"}),a.jsx(u,{stock:e})]})]})})}},5814:(e,t,s)=>{"use strict";s.d(t,{H:()=>i,a:()=>c});var a=s(5344),r=s(3729),l=s(5332);let n=(0,r.createContext)({user:null,loading:!0,signIn:async()=>{},signOut:async()=>{}});function i({children:e}){let[t,s]=(0,r.useState)(null),[i,c]=(0,r.useState)(!0);(0,r.useEffect)(()=>{console.log("AuthProvider mounted"),l.O.auth.getSession().then(({data:{session:e}})=>{console.log("Session check:",e),s(e?.user??null),c(!1)});let{data:{subscription:e}}=l.O.auth.onAuthStateChange((e,t)=>{console.log("Auth state changed:",t),s(t?.user??null),c(!1)});return()=>e.unsubscribe()},[]);let o=async(e,t)=>{let{error:s}=await l.O.auth.signInWithPassword({email:e,password:t});if(s)throw s},d=async()=>{let{error:e}=await l.O.auth.signOut();if(e)throw e};return a.jsx(n.Provider,{value:{user:t,loading:i,signIn:o,signOut:d},children:e})}let c=()=>(0,r.useContext)(n)},5332:(e,t,s)=>{"use strict";s.d(t,{O:()=>n});var a=s(6755);let r="https://uypvrugprpujbbaudtoi.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5cHZydWdwcnB1amJiYXVkdG9pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU2MTY1ODcsImV4cCI6MjA1MTE5MjU4N30.a471ztj9PPT9bAhmaDUHilsoC0CVk2o_ri2nsHxOSEs";if(console.log("Supabase URL:",r?.slice(0,10)+"..."),console.log("Anon Key exists:",!!l),!r||!l)throw Error("Missing Supabase environment variables");let n=(0,a.eI)(r,l)},1342:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>r,default:()=>n});let a=(0,s(6843).createProxy)(String.raw`C:\Coding\Virtual Trader\src\app\layout.tsx`),{__esModule:r,$$typeof:l}=a,n=a.default},1136:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>r,default:()=>n});let a=(0,s(6843).createProxy)(String.raw`C:\Coding\Virtual Trader\src\app\page.tsx`),{__esModule:r,$$typeof:l}=a,n=a.default},3824:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[638,882,994],()=>s(2739));module.exports=a})();